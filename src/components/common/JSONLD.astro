---
/**
 * JSONLD Component
 * Enhanced structured data for SEO and AI crawlers
 * Includes Person, Website, BreadcrumbList, BlogPosting, SoftwareSourceCode schemas
 */

import { SITE_CONFIG, SOCIAL_LINKS } from '../../config';

interface BreadcrumbItem {
	name: string;
	url: string;
}

interface Props {
	type?: 'website' | 'article' | 'project';
	title?: string;
	description?: string;
	publishDate?: Date;
	modifiedDate?: Date;
	tags?: string[];
	breadcrumbs?: BreadcrumbItem[];
	// For open-source projects
	projectData?: {
		name: string;
		description: string;
		url: string;
		repositoryUrl?: string;
		programmingLanguages?: string[];
		license?: string;
	};
}

const {
	type = 'website',
	title,
	description,
	publishDate,
	modifiedDate,
	tags = [],
	breadcrumbs = [],
	projectData
} = Astro.props;

const siteUrl = new URL(import.meta.env.BASE_URL, Astro.site).toString();
const currentUrl = new URL(Astro.url.pathname, Astro.site).toString();

// Enhanced Person Schema with disambiguation
const personSchema = {
	"@context": "https://schema.org",
	"@type": "Person",
	"@id": `${siteUrl}#person`,
	"name": SITE_CONFIG.name,
	"alternateName": ["Sekou Doumbouya", "Sekou M Doumbouya"],
	"url": siteUrl,
	"jobTitle": SITE_CONFIG.title,
	"worksFor": {
		"@type": "Organization",
		"name": SITE_CONFIG.currentCompany
	},
	"sameAs": [
		SOCIAL_LINKS.linkedin,
		SOCIAL_LINKS.github
	],
	"description": "Principal-level infrastructure leader specializing in multi-region architecture, platform engineering, and cost optimization. Not affiliated with professional basketball.",
	"knowsAbout": [
		"Cloud Architecture",
		"AWS",
		"Multi-Region Infrastructure",
		"Disaster Recovery",
		"Kubernetes",
		"Terraform",
		"Cost Optimization",
		"VPC Architecture",
		"Platform Engineering",
		"Site Reliability Engineering"
	],
	"hasCredential": [
		{
			"@type": "EducationalOccupationalCredential",
			"credentialCategory": "professional experience",
			"name": "Technical Lead â€“ Senior Staff Cloud Systems Engineer at Pinterest"
		},
		{
			"@type": "EducationalOccupationalCredential",
			"credentialCategory": "professional development",
			"name": "Emerge Global Executive Leadership Program, Ross School of Business, University of Michigan"
		}
	],
	"memberOf": [
		{
			"@type": "Organization",
			"name": "/dev/color",
			"description": "Community supporting Black engineers"
		}
	],
	"award": ["LiveOps Amsterdam Datacenter Creation Award"]
};

// Website Schema
const websiteSchema = {
	"@context": "https://schema.org",
	"@type": "WebSite",
	"name": `${SITE_CONFIG.name} Portfolio`,
	"url": siteUrl,
	"author": {
		"@id": `${siteUrl}#person`
	},
	"description": SITE_CONFIG.description
};

// BreadcrumbList Schema (if breadcrumbs provided)
const breadcrumbSchema = breadcrumbs.length > 0 ? {
	"@context": "https://schema.org",
	"@type": "BreadcrumbList",
	"itemListElement": breadcrumbs.map((item, index) => ({
		"@type": "ListItem",
		"position": index + 1,
		"name": item.name,
		"item": item.url
	}))
} : null;

// BlogPosting Schema (for blog posts)
const blogPostingSchema = type === 'article' && title ? {
	"@context": "https://schema.org",
	"@type": "BlogPosting",
	"headline": title,
	"author": {
		"@id": `${siteUrl}#person`
	},
	"publisher": {
		"@type": "Person",
		"@id": `${siteUrl}#person`
	},
	"url": currentUrl,
	"description": description || SITE_CONFIG.description,
	...(publishDate && { "datePublished": publishDate.toISOString() }),
	...(modifiedDate && { "dateModified": modifiedDate.toISOString() }),
	...(tags.length > 0 && { "keywords": tags.join(", ") }),
	"mainEntityOfPage": {
		"@type": "WebPage",
		"@id": currentUrl
	}
} : null;

// SoftwareSourceCode Schema (for open-source projects)
const softwareSchema = type === 'project' && projectData ? {
	"@context": "https://schema.org",
	"@type": "SoftwareSourceCode",
	"name": projectData.name,
	"description": projectData.description,
	"url": projectData.url,
	"author": {
		"@id": `${siteUrl}#person`
	},
	...(projectData.repositoryUrl && { "codeRepository": projectData.repositoryUrl }),
	...(projectData.programmingLanguages && { "programmingLanguage": projectData.programmingLanguages }),
	...(projectData.license && { "license": projectData.license })
} : null;

// Build schema array
let schemas = [personSchema, websiteSchema];
if (breadcrumbSchema) schemas.push(breadcrumbSchema);
if (blogPostingSchema) schemas.push(blogPostingSchema);
if (softwareSchema) schemas.push(softwareSchema);
---

<script type="application/ld+json" set:html={JSON.stringify(schemas)} />
