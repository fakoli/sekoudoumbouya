---
/**
 * Theme toggle button for switching between light and dark modes
 */
---

<button
	id="theme-toggle"
	type="button"
	class="theme-toggle p-2 rounded-md text-muted hover:text-foreground hover:bg-[var(--color-bg)] transition-colors"
	aria-label="Toggle theme"
>
	<!-- Sun icon (shown in dark mode) -->
	<svg
		class="sun-icon w-5 h-5 hidden"
		fill="none"
		viewBox="0 0 24 24"
		stroke="currentColor"
		stroke-width="2"
	>
		<path stroke-linecap="round" stroke-linejoin="round" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
	</svg>
	<!-- Moon icon (shown in light mode) -->
	<svg
		class="moon-icon w-5 h-5"
		fill="none"
		viewBox="0 0 24 24"
		stroke="currentColor"
		stroke-width="2"
	>
		<path stroke-linecap="round" stroke-linejoin="round" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
	</svg>
</button>

<script is:inline>
	// Theme toggle - using is:inline to ensure immediate execution
	(function initThemeToggle() {
		function updateAllToggleIcons() {
			const theme = document.documentElement.getAttribute('data-theme');
			const isDark = theme === 'dark';

			// Update desktop toggle icons
			document.querySelectorAll('.sun-icon').forEach(el => {
				el.classList.toggle('hidden', !isDark);
			});
			document.querySelectorAll('.moon-icon').forEach(el => {
				el.classList.toggle('hidden', isDark);
			});

			// Update mobile toggle icons
			document.querySelectorAll('.mobile-sun-icon').forEach(el => {
				el.classList.toggle('hidden', !isDark);
			});
			document.querySelectorAll('.mobile-moon-icon').forEach(el => {
				el.classList.toggle('hidden', isDark);
			});
		}

		function toggleTheme() {
			const currentTheme = document.documentElement.getAttribute('data-theme');
			const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

			document.documentElement.setAttribute('data-theme', newTheme);
			localStorage.setItem('theme', newTheme);
			updateAllToggleIcons();
		}

		// Expose globally for mobile menu to use
		window.toggleTheme = toggleTheme;
		window.updateAllToggleIcons = updateAllToggleIcons;

		// Initialize icon state
		updateAllToggleIcons();

		// Attach click handler to desktop toggle
		const toggle = document.getElementById('theme-toggle');
		if (toggle) {
			toggle.addEventListener('click', toggleTheme);
		}

		// Listen for system theme changes (when no stored preference)
		window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
			if (!localStorage.getItem('theme')) {
				const newTheme = e.matches ? 'dark' : 'light';
				document.documentElement.setAttribute('data-theme', newTheme);
				updateAllToggleIcons();
			}
		});
	})();
</script>

<style>
	.theme-toggle {
		position: relative;
	}

	.theme-toggle svg {
		transition: transform 0.2s ease, opacity 0.2s ease;
	}

	.theme-toggle:hover svg {
		transform: rotate(15deg);
	}
</style>
