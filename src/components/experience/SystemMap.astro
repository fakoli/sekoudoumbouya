---
/**
 * SystemMap Component
 * Static SVG "career circuit diagram" showing progression through domains
 * Pure SVG with hand-crafted positions - no physics/d3 required
 * Keyboard-focusable nodes, CSS-based domain filtering
 */

interface Node {
	id: string;
	label: string;
	domain: string;
	year: string;
	size: 'sm' | 'md' | 'lg';
}

interface Edge {
	from: string;
	to: string;
}

interface Props {
	nodes: Node[];
	edges: Edge[];
	activeDomain?: string;
}

const { nodes, edges, activeDomain } = Astro.props;

// Domain colors
const domainColors: Record<string, { fill: string; stroke: string; text: string }> = {
	'Network': { fill: '#dbeafe', stroke: '#3b82f6', text: '#1d4ed8' },
	'Cloud': { fill: '#d1fae5', stroke: '#10b981', text: '#047857' },
	'Platform': { fill: '#fef3c7', stroke: '#f59e0b', text: '#b45309' },
	'AI': { fill: '#ede9fe', stroke: '#8b5cf6', text: '#6d28d9' },
};

// Node sizes
const nodeSizes: Record<string, number> = {
	sm: 40,
	md: 50,
	lg: 60,
};

// Calculate positions (hand-crafted for visual appeal)
// This creates a left-to-right progression
const nodePositions: Record<string, { x: number; y: number }> = {
	'mckesson': { x: 100, y: 150 },
	'techteam': { x: 200, y: 100 },
	'liveops': { x: 300, y: 180 },
	'zynga': { x: 400, y: 120 },
	'box': { x: 500, y: 160 },
	'sage': { x: 600, y: 100 },
	'pinterest': { x: 720, y: 140 },
};
---

<div class="system-map-container mb-12">
	<!-- Domain Filter Buttons -->
	<div class="flex flex-wrap gap-2 mb-6" role="tablist" aria-label="Filter by domain">
		<button
			class="domain-filter-btn active"
			data-domain="all"
			role="tab"
			aria-selected="true"
		>
			All
		</button>
		{Object.entries(domainColors).map(([domain, colors]) => (
			<button
				class="domain-filter-btn"
				data-domain={domain.toLowerCase()}
				role="tab"
				aria-selected="false"
				style={`--btn-color: ${colors.stroke}`}
			>
				{domain}
			</button>
		))}
	</div>

	<!-- SVG Career Map -->
	<div class="overflow-x-auto pb-4">
		<svg
			viewBox="0 0 820 280"
			class="w-full min-w-[600px] h-auto"
			role="img"
			aria-label="Career progression diagram showing roles from McKesson through Pinterest"
		>
			<!-- Background -->
			<rect width="820" height="280" fill="var(--surface-primary)" rx="8" />

			<!-- Timeline axis -->
			<line x1="50" y1="250" x2="770" y2="250" stroke="var(--border-default)" stroke-width="1" />

			<!-- Year markers -->
			<text x="100" y="270" class="system-map-year" text-anchor="middle">2004</text>
			<text x="300" y="270" class="system-map-year" text-anchor="middle">2012</text>
			<text x="500" y="270" class="system-map-year" text-anchor="middle">2018</text>
			<text x="720" y="270" class="system-map-year" text-anchor="middle">2021</text>

			<!-- Domain labels on left -->
			<text x="30" y="80" class="system-map-domain-label" transform="rotate(-90, 30, 80)">Cloud</text>
			<text x="30" y="150" class="system-map-domain-label" transform="rotate(-90, 30, 150)">Platform</text>
			<text x="30" y="200" class="system-map-domain-label" transform="rotate(-90, 30, 200)">Network</text>

			<!-- Edges (connection lines) -->
			<g class="system-map-edges">
				<!-- McKesson → TechTeam -->
				<line x1="100" y1="150" x2="200" y2="100" class="system-map-edge" />
				<!-- TechTeam → LiveOps -->
				<line x1="200" y1="100" x2="300" y2="180" class="system-map-edge" />
				<!-- LiveOps → Zynga -->
				<line x1="300" y1="180" x2="400" y2="120" class="system-map-edge" />
				<!-- Zynga → Box -->
				<line x1="400" y1="120" x2="500" y2="160" class="system-map-edge" />
				<!-- Box → Sage -->
				<line x1="500" y1="160" x2="600" y2="100" class="system-map-edge" />
				<!-- Sage → Pinterest -->
				<line x1="600" y1="100" x2="720" y2="140" class="system-map-edge" />
			</g>

			<!-- Nodes -->
			<g class="system-map-nodes">
				<!-- McKesson -->
				<g class="system-map-node" data-domain="network" tabindex="0" role="button" aria-label="McKesson: Senior Network Engineer, 2004-2007">
					<circle cx="100" cy="150" r="25" fill="#dbeafe" stroke="#3b82f6" stroke-width="2" />
					<text x="100" y="154" text-anchor="middle" class="system-map-node-label">McKesson</text>
				</g>

				<!-- TechTeam Global -->
				<g class="system-map-node" data-domain="network" tabindex="0" role="button" aria-label="TechTeam Global: Network Consultant, 2007-2010">
					<circle cx="200" cy="100" r="22" fill="#dbeafe" stroke="#3b82f6" stroke-width="2" />
					<text x="200" y="104" text-anchor="middle" class="system-map-node-label">TechTeam</text>
				</g>

				<!-- LiveOps -->
				<g class="system-map-node" data-domain="platform" tabindex="0" role="button" aria-label="LiveOps: DevOps Engineer, 2010-2014">
					<circle cx="300" cy="180" r="28" fill="#fef3c7" stroke="#f59e0b" stroke-width="2" />
					<text x="300" y="184" text-anchor="middle" class="system-map-node-label">LiveOps</text>
				</g>

				<!-- Zynga -->
				<g class="system-map-node" data-domain="platform" tabindex="0" role="button" aria-label="Zynga: Lead Platform Engineer, 2014-2017">
					<circle cx="400" cy="120" r="30" fill="#fef3c7" stroke="#f59e0b" stroke-width="2" />
					<text x="400" y="124" text-anchor="middle" class="system-map-node-label">Zynga</text>
				</g>

				<!-- Box -->
				<g class="system-map-node" data-domain="cloud" tabindex="0" role="button" aria-label="Box: Senior Infrastructure Engineer, 2017-2019">
					<circle cx="500" cy="160" r="25" fill="#d1fae5" stroke="#10b981" stroke-width="2" />
					<text x="500" y="164" text-anchor="middle" class="system-map-node-label">Box</text>
				</g>

				<!-- Sage -->
				<g class="system-map-node" data-domain="cloud" tabindex="0" role="button" aria-label="Sage Software: Cloud Infrastructure Lead, 2019-2021">
					<circle cx="600" cy="100" r="28" fill="#d1fae5" stroke="#10b981" stroke-width="2" />
					<text x="600" y="104" text-anchor="middle" class="system-map-node-label">Sage</text>
				</g>

				<!-- Pinterest -->
				<g class="system-map-node current" data-domain="cloud" tabindex="0" role="button" aria-label="Pinterest: Principal Infrastructure Engineer, 2021-Present">
					<circle cx="720" cy="140" r="35" fill="#d1fae5" stroke="#10b981" stroke-width="3" />
					<text x="720" y="144" text-anchor="middle" class="system-map-node-label current">Pinterest</text>
					<!-- Current indicator -->
					<circle cx="720" cy="140" r="42" fill="none" stroke="#10b981" stroke-width="1" stroke-dasharray="4" opacity="0.5" />
				</g>
			</g>

			<!-- Legend -->
			<g transform="translate(50, 20)">
				<text x="0" y="0" class="system-map-legend-title">Career Domains:</text>
				<g transform="translate(100, -8)">
					<circle cx="10" cy="0" r="6" fill="#dbeafe" stroke="#3b82f6" stroke-width="1" />
					<text x="22" y="4" class="system-map-legend-text">Network</text>
				</g>
				<g transform="translate(180, -8)">
					<circle cx="10" cy="0" r="6" fill="#fef3c7" stroke="#f59e0b" stroke-width="1" />
					<text x="22" y="4" class="system-map-legend-text">Platform</text>
				</g>
				<g transform="translate(260, -8)">
					<circle cx="10" cy="0" r="6" fill="#d1fae5" stroke="#10b981" stroke-width="1" />
					<text x="22" y="4" class="system-map-legend-text">Cloud</text>
				</g>
			</g>
		</svg>
	</div>
</div>

<style>
	.system-map-container {
		background: var(--color-surface);
		border: 1px solid var(--border-default);
		border-radius: var(--radius-lg);
		padding: var(--space-6);
	}

	.domain-filter-btn {
		padding: var(--space-2) var(--space-3);
		font-size: 12px;
		font-weight: 500;
		border-radius: var(--radius-sm);
		border: 1px solid var(--border-default);
		background: var(--color-bg);
		color: var(--color-muted);
		cursor: pointer;
		transition: all var(--transition-fast);
	}

	.domain-filter-btn:hover {
		border-color: var(--btn-color, var(--border-strong));
		color: var(--color-foreground);
	}

	.domain-filter-btn.active {
		background: var(--btn-color, var(--color-accent));
		border-color: var(--btn-color, var(--color-accent));
		color: white;
	}

	.system-map-edge {
		stroke: var(--border-default);
		stroke-width: 2;
		transition: opacity var(--transition-fast);
	}

	.system-map-node {
		cursor: pointer;
		transition: transform var(--transition-fast), opacity var(--transition-fast);
	}

	.system-map-node:hover,
	.system-map-node:focus {
		transform: scale(1.05);
	}

	.system-map-node:focus {
		outline: none;
	}

	.system-map-node:focus circle {
		stroke-width: 4;
	}

	.system-map-node-label {
		font-family: var(--font-mono);
		font-size: 10px;
		font-weight: 500;
		fill: var(--color-secondary);
	}

	.system-map-node-label.current {
		font-weight: 600;
		fill: var(--color-foreground);
	}

	.system-map-year {
		font-family: var(--font-mono);
		font-size: 10px;
		fill: var(--color-muted);
	}

	.system-map-domain-label {
		font-family: var(--font-mono);
		font-size: 9px;
		fill: var(--color-faint);
		text-transform: uppercase;
		letter-spacing: 0.1em;
	}

	.system-map-legend-title {
		font-size: 10px;
		font-weight: 500;
		fill: var(--color-muted);
	}

	.system-map-legend-text {
		font-size: 10px;
		fill: var(--color-secondary);
	}

	/* Domain filtering states */
	.system-map-container[data-filter]:not([data-filter="all"]) .system-map-node:not([data-domain]) {
		opacity: 0.2;
	}

	@media (prefers-reduced-motion: reduce) {
		.system-map-node,
		.domain-filter-btn {
			transition: none;
		}
	}
</style>

<script>
	// Domain filtering functionality
	const container = document.querySelector('.system-map-container');
	const buttons = document.querySelectorAll('.domain-filter-btn');
	const nodes = document.querySelectorAll('.system-map-node');
	const edges = document.querySelectorAll('.system-map-edge');

	buttons.forEach(button => {
		button.addEventListener('click', () => {
			const domain = button.getAttribute('data-domain');

			// Update button states
			buttons.forEach(b => {
				b.classList.remove('active');
				b.setAttribute('aria-selected', 'false');
			});
			button.classList.add('active');
			button.setAttribute('aria-selected', 'true');

			// Update node visibility
			nodes.forEach(node => {
				const nodeDomain = node.getAttribute('data-domain');
				if (domain === 'all' || nodeDomain === domain) {
					node.style.opacity = '1';
				} else {
					node.style.opacity = '0.2';
				}
			});

			// Update edge visibility
			edges.forEach(edge => {
				edge.style.opacity = domain === 'all' ? '1' : '0.3';
			});
		});
	});
</script>
