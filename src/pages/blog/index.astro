---
import PageLayout from '../../layouts/PageLayout.astro';
import { getCollection } from 'astro:content';
import GradientBlob from '../../components/graphics/GradientBlob.astro';

const posts = await getCollection('blog', ({ data }) => {
	return import.meta.env.PROD ? data.draft !== true : true;
});
const sortedPosts = posts.sort((a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf());

function formatDate(date: Date) {
	return date.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' });
}

// Calculate reading time estimate
function getReadingTime(content: string = ''): string {
	const wordsPerMinute = 200;
	const words = content.split(/\s+/).length;
	const minutes = Math.ceil(words / wordsPerMinute);
	return `${minutes} min read`;
}

const base = import.meta.env.BASE_URL === '/' ? '' : import.meta.env.BASE_URL.replace(/\/$/, '');

// Group posts by year for archive view
const postsByYear = sortedPosts.reduce((acc, post) => {
	const year = post.data.publishDate.getFullYear();
	if (!acc[year]) acc[year] = [];
	acc[year].push(post);
	return acc;
}, {} as Record<number, typeof sortedPosts>);
---

<PageLayout title="Blog | Sekou Doumbouya" description="Thoughts on cloud infrastructure, engineering leadership, and technology.">
	<!-- Hero Section -->
	<section class="relative py-12 md:py-16 mb-12 overflow-hidden">
		<GradientBlob variant="secondary" size="lg" class="-top-24 -right-24 opacity-30" />

		<div class="max-w-4xl mx-auto relative z-10">
			<div class="flex items-center gap-3 mb-6">
				<span class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-purple-50 border border-purple-100">
					<svg class="w-4 h-4 text-purple-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
					</svg>
					<span class="text-sm font-medium text-purple-700">Writing</span>
				</span>
			</div>

			<h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4">Technical Insights</h1>
			<p class="text-xl text-gray-600 max-w-2xl leading-relaxed">
				Essays on systems design, infrastructure leadership, AI workloads, and lessons learned building at scale.
			</p>
		</div>
	</section>

	<!-- Featured Post (if exists) -->
	{sortedPosts.length > 0 && (
		<section class="max-w-4xl mx-auto mb-16">
			<a href={`${base}/blog/${sortedPosts[0].id}`} class="group block">
				<article class="relative bg-gradient-to-br from-slate-900 to-slate-800 rounded-3xl p-8 md:p-12 overflow-hidden hover:shadow-2xl transition-all duration-500">
					<!-- Decorative elements -->
					<div class="absolute top-0 right-0 w-96 h-96 bg-gradient-to-br from-blue-500/20 to-purple-500/20 rounded-full blur-3xl"></div>
					<div class="absolute bottom-0 left-0 w-64 h-64 bg-gradient-to-tr from-purple-500/10 to-pink-500/10 rounded-full blur-2xl"></div>

					<div class="relative z-10">
						<div class="flex flex-wrap items-center gap-3 mb-6">
							<span class="px-3 py-1 text-xs font-bold tracking-wider text-white/90 uppercase bg-white/10 rounded-full backdrop-blur-sm">
								Featured
							</span>
							<time datetime={sortedPosts[0].data.publishDate.toISOString()} class="text-sm text-white/60">
								{formatDate(sortedPosts[0].data.publishDate)}
							</time>
							{sortedPosts[0].data.readingTime && (
								<span class="text-sm text-white/60">{sortedPosts[0].data.readingTime}</span>
							)}
						</div>

						<h2 class="text-2xl md:text-3xl lg:text-4xl font-bold text-white mb-4 group-hover:text-blue-300 transition-colors leading-tight">
							{sortedPosts[0].data.title}
						</h2>

						<p class="text-lg text-white/70 mb-6 max-w-2xl leading-relaxed">
							{sortedPosts[0].data.description}
						</p>

						<div class="flex flex-wrap items-center gap-4">
							<div class="flex flex-wrap gap-2">
								{sortedPosts[0].data.tags.slice(0, 3).map(tag => (
									<span class="text-xs font-medium text-white/60 bg-white/10 px-2.5 py-1 rounded-full">
										#{tag}
									</span>
								))}
							</div>
							<span class="inline-flex items-center text-blue-300 font-medium group-hover:text-blue-200 transition-colors">
								Read article
								<svg class="w-4 h-4 ml-2 transition-transform group-hover:translate-x-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
								</svg>
							</span>
						</div>
					</div>
				</article>
			</a>
		</section>
	)}

	<!-- All Posts -->
	<section class="max-w-4xl mx-auto">
		{sortedPosts.length > 1 && (
			<div class="flex items-center justify-between mb-8">
				<h2 class="text-xl font-bold text-gray-900">All Articles</h2>
				<span class="text-sm text-gray-500">{sortedPosts.length} articles</span>
			</div>
		)}

		<div class="space-y-6">
			{sortedPosts.slice(1).map((post, index) => (
				<article class="group">
					<a href={`${base}/blog/${post.id}`} class="block relative bg-white rounded-2xl p-6 md:p-8 border border-gray-100 hover:border-gray-200 hover:shadow-lg transition-all duration-300 hover:-translate-y-0.5">
						<div class="flex flex-col md:flex-row gap-6">
							<!-- Article Number -->
							<div class="flex-shrink-0 w-14 h-14 rounded-xl bg-gradient-to-br from-gray-50 to-gray-100 flex items-center justify-center border border-gray-100">
								<span class="text-lg font-bold text-gray-400">{String(index + 2).padStart(2, '0')}</span>
							</div>

							<!-- Content -->
							<div class="flex-1 min-w-0">
								<div class="flex flex-wrap items-center gap-3 mb-3">
									<time datetime={post.data.publishDate.toISOString()} class="text-sm text-gray-400 font-medium">
										{formatDate(post.data.publishDate)}
									</time>
									{post.data.readingTime && (
										<>
											<span class="text-gray-300">|</span>
											<span class="text-sm text-gray-400">{post.data.readingTime}</span>
										</>
									)}
								</div>

								<h3 class="text-xl font-bold text-gray-900 mb-3 group-hover:text-blue-600 transition-colors leading-tight">
									{post.data.title}
								</h3>

								<p class="text-gray-600 mb-4 leading-relaxed line-clamp-2">
									{post.data.description}
								</p>

								<div class="flex flex-wrap items-center gap-3">
									{post.data.tags.slice(0, 4).map(tag => (
										<span class="text-xs font-medium text-purple-600 bg-purple-50 px-2.5 py-1 rounded-full">
											#{tag}
										</span>
									))}
								</div>
							</div>

							<!-- Arrow -->
							<div class="hidden md:flex items-center">
								<svg class="w-5 h-5 text-gray-300 group-hover:text-blue-500 transition-all group-hover:translate-x-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
								</svg>
							</div>
						</div>
					</a>
				</article>
			))}
		</div>

		{sortedPosts.length === 0 && (
			<div class="text-center py-20">
				<div class="w-20 h-20 mx-auto mb-6 rounded-full bg-gradient-to-br from-gray-50 to-gray-100 flex items-center justify-center">
					<svg class="w-10 h-10 text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
					</svg>
				</div>
				<h2 class="text-2xl font-bold text-gray-900 mb-3">Coming Soon</h2>
				<p class="text-gray-600 max-w-md mx-auto">
					New articles on cloud architecture, infrastructure leadership, and engineering best practices are on the way.
				</p>
			</div>
		)}
	</section>

	<!-- Newsletter / Subscribe Section -->
	<section class="max-w-4xl mx-auto mt-20 mb-8">
		<div class="relative bg-gradient-to-r from-blue-50 via-purple-50 to-blue-50 rounded-2xl p-8 md:p-12 overflow-hidden">
			<div class="absolute top-0 right-0 w-64 h-64 bg-gradient-to-br from-blue-200/30 to-purple-200/30 rounded-full blur-3xl"></div>

			<div class="relative z-10 text-center">
				<div class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-white border border-gray-200 mb-4">
					<svg class="w-4 h-4 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
					</svg>
					<span class="text-sm font-medium text-gray-700">Stay Updated</span>
				</div>

				<h3 class="text-2xl font-bold text-gray-900 mb-3">Want to hear about new posts?</h3>
				<p class="text-gray-600 mb-6 max-w-lg mx-auto">
					Follow me on LinkedIn or check back for new articles on cloud architecture and infrastructure leadership.
				</p>

				<a
					href="https://linkedin.com/in/sekoudoumbouya"
					target="_blank"
					rel="noopener noreferrer"
					class="inline-flex items-center gap-2 px-6 py-3 bg-[#0077b5] text-white font-semibold rounded-xl hover:bg-[#006399] transition-colors shadow-lg shadow-blue-500/20"
				>
					<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
						<path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 21.227.792 22 1.771 22h20.451C23.2 22 24 21.227 24 20.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
					</svg>
					Connect on LinkedIn
				</a>
			</div>
		</div>
	</section>
</PageLayout>
