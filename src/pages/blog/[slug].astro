---
import { getCollection, render } from 'astro:content';
import PageLayout from '../../layouts/PageLayout.astro';

export async function getStaticPaths() {
	const posts = await getCollection('blog', ({ data }) => {
		return import.meta.env.PROD ? data.draft !== true : true;
	});
	return posts.map((post) => ({
		params: { slug: post.id },
		props: { post },
	}));
}

const { post } = Astro.props;
const { Content } = await render(post);

function formatDate(date: Date) {
	return date.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' });
}

const base = import.meta.env.BASE_URL === '/' ? '' : import.meta.env.BASE_URL.replace(/\/$/, '');
---

<PageLayout title={`${post.data.title} | Blog`} description={post.data.description}>
	<article class="max-w-3xl mx-auto">
		<header class="mb-12 text-center">
			<div class="mb-6">
				<a href={`${base}/blog`} class="text-blue-600 hover:underline">&larr; Back to Technical Insights</a>
			</div>
			<h1 class="text-4xl md:text-5xl font-bold mb-4">{post.data.title}</h1>
			<div class="text-gray-500">
				<time datetime={post.data.publishDate.toISOString()}>
					{formatDate(post.data.publishDate)}
				</time>
			</div>
		</header>

		<div class="prose prose-lg prose-blue max-w-none mx-auto">
			<Content />
		</div>
	</article>
</PageLayout>
