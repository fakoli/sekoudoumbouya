---
import { getCollection, render } from 'astro:content';
import PageLayout from '../../layouts/PageLayout.astro';
import { getBasePath } from '../../utils/paths';
import { formatDate } from '../../utils/dates';

export async function getStaticPaths() {
	const posts = await getCollection('blog', ({ data }) => {
		return import.meta.env.PROD ? data.draft !== true : true;
	});
	return posts.map((post) => ({
		params: { slug: post.id },
		props: { post },
	}));
}

const { post } = Astro.props;
const { Content } = await render(post);
const base = getBasePath();

// Breadcrumbs for structured data
const siteUrl = Astro.site ? new URL(base, Astro.site).toString() : '';
const breadcrumbs = siteUrl ? [
	{ name: 'Home', url: siteUrl },
	{ name: 'Writing', url: `${siteUrl}/writing` },
	{ name: post.data.title, url: `${siteUrl}/blog/${post.id}` },
] : [];
---

<PageLayout title={`${post.data.title} | Blog`} description={post.data.description} type="article" publishDate={post.data.publishDate} breadcrumbs={breadcrumbs}>
	<article class="max-w-3xl mx-auto">
		<header class="mb-12 text-center">
			<div class="mb-6">
				<a href={`${base}/blog`} class="link body-sm">&larr; Back to Technical Insights</a>
			</div>
			<h1 class="heading-xl text-foreground mb-4">{post.data.title}</h1>
			<div class="text-muted tabular-nums">
				<time datetime={post.data.publishDate.toISOString()}>
					{formatDate(post.data.publishDate)}
				</time>
			</div>
		</header>

		<div class="prose prose-lg max-w-none mx-auto prose-headings:font-semibold prose-headings:tracking-tight prose-a:no-underline hover:prose-a:underline">
			<Content />
		</div>
	</article>
</PageLayout>
